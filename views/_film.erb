<head>
  <%= erb :_header %>
  <link rel="stylesheet" type="text/css" href="../styles/review_style.css">
  <style>
  /* Make the image fully responsive */
  .carousel-inner img {
      width: 100%;
      height: 100%;
  }
  </style>
</head>
<body>
  <h1 style="text-align:center"><%= @title %></h1>
  <div style="text-align:center;margin-bottom:10px">
    <iframe width="420" height="315"
      src='<%= @src %>' frameborder="0" allowfullscreen>
    </iframe>
  </div>

  <div style="text-align:center;margin-bottom:10px">
    <p><%= @film.overview %></p>
  </div>

  <div class="container">

    <div class="row">
      <div class="col-xl-10">
        <% if @showtime_error %>
          <p>Too many results - please check showtimes <a href="<%= @showtime_error %>">here</a></p>
        <% else %>
          <% @showtimes.each do |showtime| %>
            <p>Showing at <a href="<%= showtime.website %>" target="_blank"><%= showtime.cinema_name %></a> on <%= DateHelper.screen_date(showtime.start_at) %> <% if showtime.booking_link %><a href="<%= showtime.booking_link %>"><i>Buy tickets</i></a><% end %></p>
          <% end %>
        <% end %>
      </div>
    </div>

    <div class="row">
      <div class="col-xl-10">
      <h2>Reviews</h2>
      <ul>
       <% @reviews.each do |review|  %>
        <li> <%=review.review_content %>
          <p>Reviewed by <%=@user_model.find_by_id(review.user_id).email %></p>
        </li>
       <% end %>
      </ul>
      <!-- <h2>Add a review for <%= @film.title %></h2> -->
      <!-- Trigger/Open The Modal -->
      <button onclick="openAddReview()">Add a review</button>
      <!-- The Modal -->
      <div id="myModal" class="modal">
        <!-- Modal content -->
        <div class="modal-content">
          <span class="close">&times;</span>
          <div style="text-align: center">
            <form action="/films/<%= @film.film_id %>" method="POST">
                <textarea rows="20" name="review" cols="90" ></textarea>
                <input type="submit" value="Add review">
            </form>
          </div>
        </div>
      </div>
      </div>
    </div>

  <div class="row" style="text-align:center">
    <div class="col-xl-10">
    <% unless @recommendations.empty? %>
    <h2>If you liked this, you may also like:</h2>
    <div id="myCarousel" class="carousel slide" data-ride="carousel" style="margin: auto;width: 250px; height:250px;">
      <!-- Wrapper for slides -->
      <div class="carousel-inner">

        <div class="carousel-item active">
          <img class="recommendation" src="https://image.tmdb.org/t/p/w780/<%= @recommendations[0].poster_path %>"  alt="<%= @recommendations[0].title %>" style="width:100%;" data-id=<%= @recommendations[0].film_id %> data-title="<%= @recommendations[0].title %>" data-year=<%= @recommendations[0].year %> data-poster_path="<%= @recommendations[0].poster_path %>" data-backdrop_path="<%= @recommendations[0].backdrop_path %>" data-overview="<%= @recommendations[0].overview %>">
        </div>

        <% @recommendations[1..-1].each do |recommendation| %>
        <div class="carousel-item">
          <img class="recommendation" src="https://image.tmdb.org/t/p/w780/<%= recommendation.poster_path %>"  alt="<%= recommendation.title %>" style="width:100%;" data-id=<%= recommendation.film_id %> data-title="<%= recommendation.title %>" data-year=<%= recommendation.year %> data-poster_path="<%= recommendation.poster_path %>" data-backdrop_path="<%= recommendation.backdrop_path %>" data-overview="<%= recommendation.overview %>">
        </div>
        <% end %>
      </div>

        <!-- Left and right controls -->
        <a class="carousel-control-prev" href="#myCarousel" data-slide="prev">
          <span class="carousel-control-prev-icon"></span>
        </a>
        <a class="carousel-control-next" href="#myCarousel" data-slide="next">
          <span class="carousel-control-next-icon"></span>
        </a>
      </div>
    </div>
    <% end %>
    </div>
  </div>
  <script type="text/javascript">
    window.onload = function() {
      let recommendations = document.getElementsByClassName('recommendation');
      let createFilm = function(){
        let film = this;
        $.post('/create', {id:film.dataset.id, title:film.dataset.title, year: film.dataset.year, poster_path: film.dataset.poster_path, backdrop_path:film.dataset.backdrop_path, overview:film.dataset.overview}, function(data, status, xhr){
        })
        .done(function(data) {
          window.location.replace("/films/" + film.dataset.id);
        })
        .fail(function (jqxhr,settings,ex) { alert('failed, '+ ex); });
      }
      for (let i = 0; i < recommendations.length; i++) {
        recommendations[i].addEventListener('click', createFilm, false);
      }
    };
  </script>
  <script src="../scripts/review.js"></script>
</body>
